/*!
 * jQuery flowGallery plugin: Cover Flow Image Gallery
 * Examples and documentation at: http://github.com/bozz/flowGallery
 * version 0.6.5 (04-NOV-2012)
 * Author: Boris Searles (boris@lucidgardens.com)
 * Requires jQuery v1.3.2 or later
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */(function(a){a.fn.flowGallery=function(d){return b=a.extend(a.fn.flowGallery.defaults,d),this.each(function(a){c(this)})},a.fn.flowGallery.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",thumbWidth:"auto",thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900};var b={},c=function(c){_elCounter=0,_activeIndex=0,_activeElem=!1,_activeLoaded=!1,_listElem=!1,_listWidth=0,_listHeight=0,_centerX=0,_centerY=0,_container=null,_imgData=[],_listElem=c,_container=a(_listElem).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent(),b.circular&&(_children=a(_listElem).children(),_children.clone().prependTo(_listElem),_children.clone().appendTo(_listElem),b.activeIndex=b.activeIndex+_children.length);var g=document.createElement("div"),i=document.createElement("p");a(i).addClass("bf-caption").css({backgroundColor:b.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(b.imagePadding+10)+"px 15px",position:"absolute"}),a(g).addClass("bf-wrapper").css({position:"relative"}).append(_listElem).append(i),_container.append(g),a(window).resize(function(){_listWidth=_container.width(),_centerX=_listWidth*.5,f(),h(_activeElem)});var m=a(_listElem).children(),n=!1;m.each(function(c){var d=a(this).find("img");b.forceWidth&&d.width(b.forceWidth);var f=k(d.get(0)),g=j(d,f);_imgData.push(g),l(d,c),c===_activeIndex&&f&&(n=g.h),e(this,c)}),_listWidth=_container.width(),_centerX=_listWidth*.5,n?_centerY=b.thumbTopOffset==="auto"?n*.5:b.thumbTopOffset:_centerY=b.thumbTopOffset==="auto"?_listHeight*.5:b.thumbTopOffset+b.thumbHeight*.5,b.enableKeyNavigation===!0&&a(document).unbind("keydown",d).keydown(d),f()},d=function(a){a.keyCode===37?n(-1):a.keyCode===39&&n(1)},e=function(c,d){a(c).css({backgroundColor:b.backgroundColor,position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"}),!_activeElem&&b.activeIndex===d&&(a(c).addClass("active"),_activeElem=c,_activeIndex=d),_elCounter++},f=function(c){var d=!0,e,i,j,k,l=0,m=null,n=function(){h(_activeElem),_container.width()!==_listWidth&&(_listWidth=_container.width(),_centerX=_listWidth*.5,f(),h(_activeElem))},o={};a(_listElem).children().each(function(e){a(this).hasClass("active")?(o={left:_centerX-b.imagePadding-_imgData[e].w*.5+"px",top:"0",width:_imgData[e].w+"px",height:_imgData[e].h+"px",padding:b.imagePadding+"px"},d=!1,m=n):(o={left:g(e,d),top:_centerY-_imgData[e].th*.5+"px",width:_imgData[e].tw+"px",height:_imgData[e].th+"px",padding:b.thumbPadding+"px"},m=null),c?a(this).stop().animate(o,{duration:b.duration,easing:b.easing,complete:m}):(a(this).css(o),m&&m())})},g=function(a,c){var d=_centerX;if(c){d-=_imgData[_activeIndex].w*.5,d-=b.imagePadding,d-=(_activeIndex-a)*10,d-=(_activeIndex-a)*2*b.thumbPadding;for(i=a;i<_activeIndex;i++)d-=_imgData[i].tw;return d+"px"}d+=_imgData[_activeIndex].w*.5,d+=b.imagePadding,d+=(a-_activeIndex)*10,d+=(a-_activeIndex)*2*b.thumbPadding;for(i=_activeIndex+1;i<a;i++)d+=_imgData[i].tw;return d+"px"},h=function(c){var d=a(c).find("img").get(0);if(!k(d))return!1;var e=a(c).parent().parent().find("p.bf-caption"),f=d.title;if(d.title.length>0){e.html(f),e.css({left:_centerX-b.imagePadding-_imgData[_activeIndex].w*.5,top:_imgData[_activeIndex].h+b.imagePadding*2,width:_imgData[_activeIndex].w-20});var g=a(_listElem).height()+e.height()+40;a(_listElem).parent().height(g),e.fadeIn("fast")}},j=function(a,c){c=c||!1;var d,e,f,g=0;if(c){var h=a.get(0);if(typeof h.naturalWidth!="undefined")d=b.forceWidth||h.naturalWidth||h.width,e=b.forceHeight||h.naturalHeight||h.height;else{var i=new Image;i.src=a.attr("src"),d=i.width,e=i.height}}else d=a.attr("width"),e=a.attr("height");return b.thumbWidth==="auto"&&b.thumbHeight=="auto"?(f=100,g=Math.round(e*100/d)):b.thumbHeight==="auto"?(f=b.thumbWidth,g=Math.round(e*Number(b.thumbWidth)/d)):b.thumbWidth==="auto"?(f=Math.round(d*Number(b.thumbHeight)/e),g=b.thumbHeight):(f=b.thumbWidth,g=b.thumbHeight),r(e),{h:e,w:d,th:g,tw:f}},k=function(a){return b.forceWidth&&b.forceHeight||a.width>b.thumbWidth&&a.height>20?!0:a.complete?typeof a.naturalWidth!="undefined"&&a.naturalWidth===0?!1:!0:!1},l=function(c,d){c.hide().parent().addClass(b.loadingClass).css({height:_imgData[d].th,width:_imgData[d].tw});var e=function(e){if(this.complete||this.readyState==="complete"&&e.type==="readystatechange"){a(this).css("visibility","visible").parent().removeClass(b.loadingClass),a(this).fadeIn();var g=j(c,!0);_imgData[d]=g;if(d===b.activeIndex)_activeLoaded=!0,_centerY=b.thumbTopOffset==="auto"?g.h*.5:b.thumbTopOffset,e&&f();else{var h={height:g.th};_activeLoaded&&(h.top=_centerY-_imgData[d].th*.5+"px"),c.parent().animate(h)}m(c.parent())}},g=c.get(0);g.complete?e.call(g):c.bind("load readystatechange",e).bind("error",function(){a(this).css("visibility","visible").parent().removeClass(b.loadingClass)})},m=function(c){a(c).click(function(){this!==_activeElem?(a("p.bf-caption").hide(),_currentIndex=_activeIndex,_activeIndex=0,_activeElem=this,a(this).parent().children().each(function(a){_activeElem===this&&(_activeIndex=a)}),q(_currentIndex),f(b.animate)):b.forwardOnActiveClick===!0&&n(1)})},n=function(c){_currentIndex=_activeIndex;if(c<0&&_activeIndex>0)_activeIndex+=c;else if(c>0&&_activeIndex<_imgData.length-1)_activeIndex+=c;else return!1;_activeElem=a(_listElem).children().get(_activeIndex),q(_currentIndex),f(b.animate)},o=function(b,c){var d=_activeIndex;_activeIndex=b+c,_activeElem=a(_listElem).children().get(_activeIndex),a(_listElem).find(".active").removeClass("active"),a(_activeElem).addClass("active"),f(!1),_activeIndex=d+c,_activeElem=a(_listElem).children().get(_activeIndex)},p=function(b){var c=a(_listElem).children().length/3;b>_activeIndex?_activeIndex<c&&o(b,c):_activeIndex>c*2-1&&o(b,-c)},q=function(c){b.circular&&p(c),a("p.bf-caption").hide(),a(_listElem).find(".active").removeClass("active"),a(_activeElem).addClass("active"),_listWidth=_container.width(),_centerX=_listWidth*.5},r=function(c){c>_listHeight&&(_listHeight=c,_listHeight+=b.imagePadding*2,a(_listElem).height(_listHeight))}})(jQuery);